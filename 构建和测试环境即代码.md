# 构建和测试环境即代码

`构建和测试环境即代码`和`基础设施即代码`，`流水线即代码`的概念相似，就是将你的代码构建和测试环境使用代码来表达，以达到**代码在本机正常工作...同时在任何地方都可以正常工作**。

回想这样一个场景，当你加入一个想公司或者加入一个新项目的时候，是不是需要安装很多软件以使得新项目的服务可以在你本机运行？

假设这个新项目使用的编程语言是NodeJs，使用Mysql存储数据，那么很可能会出现如下情况，每个开发人员本机安装的软件版本都不太相同：

- 开发小A本机环境：NodeJS 8.1, MySQL 5.4
- 开发小B本机环境：NodeJS 8.1, MySQL 5.4
- 开发小C本机环境：NodeJS 9.2, MySQL 5.2
- 开发小D本机环境：NodeJS 12.4, MySQL 5.1

这就是为什么有时候你编写好的代码或者测试在你本机运行成功，但到了别人的机器上就会出问题，原因很可能是你的代码依赖了你本地开发环境的软件版本。

这个问题甚至曾经在Google也非常严重。在2016的时候，Google就发现84%新的失败测试都是由于`flakiness`。什么是flakiness呢？

> 一个flaky测试就是在相同的配置的情况下这个测试可能会成功也可能会失败.

这个测试是不是很像薛定谔的猫，不运行的时候测试状态处于叠加状态，既可以是成功也可以是失败，当你运行之后才知道是成功还是失败。自动化测试重要性不必多说，但falky测试显然令人很疑惑，或者说是沮丧，我们为何要有这样的测试，没有它情况甚至会更好。